<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Predicting Loan Outcomes</title>
  <link rel="stylesheet" type="text/css" href="cs109a.css">
</head>
<body>
<h1 style="text-align:center">Predicting Loan Outcomes using Machine Learning</h1>
  <div class='ournames'>
    <h3>David Modjeska and Andrew Greene</h3>
    <h4>CS109a: Introduction to Data Science<br>
    Harvard University, Autumn 2016</h4>
  </div>

<ul class='toc'>
 <li><a href='index.html'>Home</a></li>
 <li><a href='01-Context.html'>1. Initial Context</a></li>
 <li><a href='02-Collection.html'>2. Data Collection</a></li>
 <li><a href='03-Exploration.html'>3. Data Exploration</a></li>
 <li><a href='04-Modeling.html'>4. Data Modeling</a></li>
 <li><a href='05-Analysis.html'>5. Modeling Analysis</a></li>
</ul>

<h2>Part 5: Modeling Analysis</h2>

<p>In this part, we will compare the models developed in the part 4 with each other. On the basis of the strongest model(s), we will look at the predictors that most influence results.</p>

<p>We will also explore how participants in the Lending Club ecology have varying criteria for success. For example, the Lending Club institution wishes to improve their grading algorithm and set interest rates commensurate with risk. An individual investor, by contrast, wishes to minimize the likelihood of default. Alternatively, an investor may wish to maximize their total return, taking into account that a default often follows a history of partial payments, thereby generating positive revenue. Choosing an appropriate loss function affects selection of the most successful model, which is the focus of this final report part.</p>


<h3>Summary comparison of all models:</h3>

<div class='summary_table'>
<a></a><a></a><table><thead><tr><th>Model</th>
<th>auc</th>
<th>baseline</th>
<th>f1</th>
<th>prec</th>
<th>score</th>
<th>test_f1</th>
<th>test_prec</th>
<th>test_profit</th>
<th>test_score</th></tr></thead>
<tbody>
<tr><th>RandomForestClassifier</th>
<td>0.497518</td>
<td>0.860074</td>
<td>0.716248</td>
<td>0.859688</td>
<td>0.582459</td>
<td>0.533418</td>
<td>0.864835</td>
<td>-24.230891</td>
<td>0.581941</td></tr>
<tr><th>LogReg PCA Balanced</th>
<td>0.500083</td>
<td>0.860074</td>
<td>0.657955</td>
<td>0.858047</td>
<td>0.524233</td>
<td>0.606677</td>
<td>0.861497</td>
<td>20.41234</td>
<td>0.523668</td></tr>
<tr><th>LogReg PCA</th>
<td>0.500229</td>
<td>0.860074</td>
<td>0.924484</td>
<td>0.793333</td>
<td>0.859595</td>
<td>0.001294</td>
<td>0.857143</td>
<td>-236.575713</td>
<td>0.862136</td></tr>
<tr><th>LogisticRegression</th>
<td>0.499836</td>
<td>0.860074</td>
<td>0.698902</td>
<td>0.914265</td>
<td>0.564614</td>
<td>0.002048</td>
<td>0.826087</td>
<td>-230.23108</td>
<td>0.560531</td></tr>
<tr><th>LogReg balanced basic x^3</th>
<td>0.564158</td>
<td>0.847953</td>
<td>0.659433</td>
<td>0.823989</td>
<td>0.535093</td>
<td>0.593443</td>
<td>0.822941</td>
<td>31.757548</td>
<td>0.539385</td></tr>
<tr><th>LogReg balanced basic x^2</th>
<td>0.563749</td>
<td>0.847953</td>
<td>0.670414</td>
<td>0.823727</td>
<td>0.545276</td>
<td>0.585755</td>
<td>0.822404</td>
<td>45.756872</td>
<td>0.545796</td></tr>
<tr><th>LogReg balanced employ x^2</th>
<td>0.563749</td>
<td>0.847953</td>
<td>0.670414</td>
<td>0.823727</td>
<td>0.545276</td>
<td>0.585755</td>
<td>0.822404</td>
<td>45.756872</td>
<td>0.545796</td></tr>
<tr><th>DTC log2 balanced</th>
<td>0.582779</td>
<td>0.847953</td>
<td>0.672614</td>
<td>0.817077</td>
<td>0.55376</td>
<td>0.632295</td>
<td>0.818314</td>
<td>220.314522</td>
<td>0.508332</td></tr>
<tr><th>Stack Tree balanced (mixed)</th>
<td>0.588177</td>
<td>0.847953</td>
<td>0.798964</td>
<td>0.804515</td>
<td>0.683025</td>
<td>0.383033</td>
<td>0.818004</td>
<td>-363.46915</td>
<td>0.683409</td></tr>
<tr><th>DTC</th>
<td>0.543669</td>
<td>0.847953</td>
<td>0.791997</td>
<td>0.809156</td>
<td>0.674297</td>
<td>0.447295</td>
<td>0.815801</td>
<td>-267.741252</td>
<td>0.64598</td></tr>
<tr><th>DTC sqrt balanced</th>
<td>0.548462</td>
<td>0.847953</td>
<td>0.756043</td>
<td>0.810064</td>
<td>0.633844</td>
<td>0.472163</td>
<td>0.812912</td>
<td>-228.90259</td>
<td>0.63106</td></tr>
<tr><th>Stack RF balanced (mixed)</th>
<td>0.588829</td>
<td>0.847953</td>
<td>0.80685</td>
<td>0.803577</td>
<td>0.692641</td>
<td>0.312236</td>
<td>0.811109</td>
<td>-500.528518</td>
<td>0.722535</td></tr>
<tr><th>Stack LogReg balanced (mixed)</th>
<td>0.588821</td>
<td>0.847953</td>
<td>0.807932</td>
<td>0.802166</td>
<td>0.694025</td>
<td>0.384472</td>
<td>0.810072</td>
<td>-356.430484</td>
<td>0.684658</td></tr>
<tr><th>RFC balanced 2/100</th>
<td>0.637726</td>
<td>0.847953</td>
<td>0.713025</td>
<td>0.791972</td>
<td>0.594422</td>
<td>0.531847</td>
<td>0.789251</td>
<td>-67.064904</td>
<td>0.59897</td></tr>
<tr><th>RFC balanced 3/100</th>
<td>0.641098</td>
<td>0.847953</td>
<td>0.723229</td>
<td>0.788135</td>
<td>0.605173</td>
<td>0.521847</td>
<td>0.786758</td>
<td>-72.396041</td>
<td>0.606925</td></tr>
<tr><th>RFC balanced 4/100</th>
<td>0.644534</td>
<td>0.847953</td>
<td>0.739146</td>
<td>0.782391</td>
<td>0.622241</td>
<td>0.506856</td>
<td>0.783463</td>
<td>-106.082474</td>
<td>0.618392</td></tr>
<tr><th>RFC balanced 5/100</th>
<td>0.646437</td>
<td>0.847953</td>
<td>0.748665</td>
<td>0.781217</td>
<td>0.63207</td>
<td>0.494005</td>
<td>0.780173</td>
<td>-150.199915</td>
<td>0.628126</td></tr>
<tr><th>RFC balanced 5/300</th>
<td>0.647522</td>
<td>0.847953</td>
<td>0.753882</td>
<td>0.779911</td>
<td>0.637677</td>
<td>0.4913</td>
<td>0.779519</td>
<td>-153.573796</td>
<td>0.630129</td></tr>
<tr><th>RFC balanced 6/100</th>
<td>0.648098</td>
<td>0.847953</td>
<td>0.757184</td>
<td>0.777485</td>
<td>0.641615</td>
<td>0.47975</td>
<td>0.777155</td>
<td>-177.027263</td>
<td>0.638402</td></tr>
<tr><th>RFC balanced 7/100</th>
<td>0.649799</td>
<td>0.847953</td>
<td>0.773191</td>
<td>0.774318</td>
<td>0.659038</td>
<td>0.461265</td>
<td>0.773476</td>
<td>-215.995358</td>
<td>0.651213</td></tr>
<tr><th>RFC balanced 8/100</th>
<td>0.649646</td>
<td>0.847953</td>
<td>0.78746</td>
<td>0.76903</td>
<td>0.675431</td>
<td>0.434595</td>
<td>0.768145</td>
<td>-265.046493</td>
<td>0.668878</td></tr>
<tr><th>RFC balanced 9/100</th>
<td>0.648587</td>
<td>0.847953</td>
<td>0.803712</td>
<td>0.762916</td>
<td>0.694556</td>
<td>0.40765</td>
<td>0.764767</td>
<td>-321.111447</td>
<td>0.685118</td></tr>
<tr><th>SmallBusiness</th>
<td>0.506549</td>
<td>0.847953</td>
<td>0.911339</td>
<td>0.762568</td>
<td>0.837875</td>
<td>0.033954</td>
<td>0.761267</td>
<td>-869.029054</td>
<td>0.83824</td></tr>
<tr><th>QDA</th>
<td>0.625773</td>
<td>0.847953</td>
<td>0.917424</td>
<td>0.759286</td>
<td>0.847491</td>
<td>0.001859</td>
<td>0.744444</td>
<td>-913.637756</td>
<td>0.847833</td></tr>
<tr><th>LogReg balanced .6</th>
<td>0.655212</td>
<td>0.847953</td>
<td>0.723575</td>
<td>0.728662</td>
<td>0.607445</td>
<td>0.283763</td>
<td>0.73638</td>
<td>-489.694574</td>
<td>0.604203</td></tr>
<tr><th>Stack RF balanced (logreg)</th>
<td>0.501042</td>
<td>0.847953</td>
<td>0.733312</td>
<td>0.576167</td>
<td>0.706008</td>
<td>0.001831</td>
<td>0.589286</td>
<td>-913.237437</td>
<td>0.848116</td></tr>
<tr><th>Stack LogReg balanced (logreg)</th>
<td>0.501616</td>
<td>0.847953</td>
<td>0.917591</td>
<td>0.545397</td>
<td>0.847846</td>
<td>0.00208</td>
<td>0.576923</td>
<td>-912.78824</td>
<td>0.848116</td></tr>
<tr><th>Stack Tree balanced (logreg)</th>
<td>0.501616</td>
<td>0.847953</td>
<td>0.917573</td>
<td>0.559286</td>
<td>0.847811</td>
<td>0.00208</td>
<td>0.576923</td>
<td>-912.78824</td>
<td>0.848116</td></tr>
<tr><th>GBC</th>
<td>0.630332</td>
<td>0.847953</td>
<td>0.917717</td>
<td>NaN</td>
<td>0.847953</td>
<td>0</td>
<td>NaN</td>
<td>-915.941869</td>
<td>0.848351</td></tr>
<tr><th>GBC PCA</th>
<td>0.491381</td>
<td>0.860074</td>
<td>0.92477</td>
<td>NaN</td>
<td>0.860074</td>
<td>0</td>
<td>NaN</td>
<td>-237.070559</td>
<td>0.862602</td></tr>
<tr><th>GradientBoostingClassifier</th>
<td>0.495911</td>
<td>0.860074</td>
<td>0.92477</td>
<td>NaN</td>
<td>0.860074</td>
<td>0</td>
<td>NaN</td>
<td>-230.871859</td>
<td>0.862602</td></tr>
<tr><th>QuadraticDiscriminantAnalysis</th>
<td>0.495139</td>
<td>0.860074</td>
<td>0.92477</td>
<td>NaN</td>
<td>0.860074</td>
<td>0</td>
<td>NaN</td>
<td>-230.871859</td>
<td>0.862602</td></tr>
<tr><th>RFC 5/300</th>
<td>0.646762</td>
<td>0.847953</td>
<td>0.917717</td>
<td>NaN</td>
<td>0.847953</td>
<td>0</td>
<td>NaN</td>
<td>-915.941869</td>
<td>0.848351</td></tr>
</tbody></table>
</div>

<p><img src="images/image32.png" style="width: 60%;"></p>

<p><img src="images/image29.png" style="width: 60%;"></p>

<p><img src="images/image28.png" style="width: 60%;"></p>

<p>*** TODO: Unravel important predictors<sup><a href="#cmnt3">[c]</a></sup></p>
<h3>Using &ldquo;Payback Ratio&rdquo; to transform classification into regression</h3>

<p>The modelling outcome that we&rsquo;ve used thus far is a categorical one: a &ldquo;Fully Paid&rdquo; loan is assigned the label 1, and a loan that has defaulted is assigned the label 0. By replacing this outcome with a continuous &ldquo;payback ratio&rdquo; measure, we can investigate the use of regression techniques.</p>

<p>We define the payback ratio as follows: For any given loan, the amount that has been paid by the borrower is the sum of three data columns: &ldquo;total received principal&rdquo;, &ldquo;total received interest&rdquo;, and &ldquo;total received late fees&rdquo;. In addition, the amount that a borrower is expected to pay is the value in the &ldquo;installment&rdquo; column times the overall number of payments. We have previously filtered loans to 36-month terms earlier in this modeling pipeline. The ratio of &ldquo;actual payments&rdquo; / &ldquo;expected payments&rdquo; is the raw payback ratio. This ratio is compatible with category labels of 0 and 1: a loan that is paid as expected will result in &ldquo;1&rdquo; using both approaches, and a loan in which the borrower &ldquo;takes the money and runs&rdquo; will result in &ldquo;0&rdquo; with both approaches. </p>

<p>We will need to make one further adjustment. If a loan is paid off early, then the &ldquo;actual payments&rdquo; will be less than the &ldquo;expected payments&rdquo; but the time value of money will make up the difference -- since the loan was repaid early, the money can be reinvested, and no loss is incurred by the investor. Consequently, for loans that are &ldquo;Fully Paid&rdquo; we take the payment ratio to be 1, and it is only for written-off loans that we compute the actual payment ratio.</p>

<p>Having defined our continuous outcome, we can now employ linear regression (with various basis functions) for modelling. Our first attempt is with cross-validated Ridge regression, which gives a test R<sup>2</sup> of 0.036 -- not an encouraging result. (This is nevertheless much better than the result from unregularized linear regression, which gives a test R<sup>2</sup> of only 0.006. Cross-validated Lasso gives a test R<sup>2</sup> of 0.014.)</p>

<p>We try again with cross-terms and, for the continuous predictors, polynomial terms up to ninth degree -- all of these give increasingly negative values for the test R<sup>2</sup>.</p>

<p>Finally, we try using a cutoff to transform our linear regression model back to a classification problem. This approach does not perform well, with an AUC of 0.536:</p>

<p><img src="images/image17.png" style="width: 40%;"></p>

<h3>Modelling goals and success opportunities</h3>

<p>In Part 2 of this report, we discussed the problem posed by the selection bias in this data. In particular, because the corpus includes only approved loans, we cannot assess whether our model correctly reduces the proportion of false negatives. Consequently, the only way to improve our classification rate is to reduce the proportion of false positives. If that task were easy, the existing LC models would have already eliminated these false positives from the Kaggle data set. Our models have unfortunately little to offer Lending Club as an organization.</p>

<p>On the other hand, there is a relevant principle to follow: &ldquo;I don&rsquo;t have to outrun the bear, I only have to outrun you&rdquo;. Nate Silver makes a similar observation in his book The Signal and The Noise (Penguin, 2015). So we can definitely offer value to the individual Lending Club member. Say that a member wishes to invest an arbitrary amount of money, with a maximum established for the risk placed on any one loan. We can choose one of our models and use it to rank all available loans in order of probability of being paid in full. We can then allocate the maximum per-loan amount (or the remaining to-be-funded balance) on the top-ranked loans until the member&rsquo;s resources are fully allocated. This triage approach would serve as a sort of intermediary or para-advisor between Lending Club and the individual investor, sorting out complexity, reducing uncertainty, and increasing confidence in the process.</p>

<h3>Future Research</h3>

<p>Future research suggested by this work would proceed in two primary directions. Both of these directions are broadly investor-side. First, it would be useful to validate the benefit of priority ranking approved loans as a route to financial gain. This validation would likely lead to model refinements and perhaps tuning of the data science pipeline on the basis of investor feedback. Second, it would be highly useful to investigate the nature of unapproved loans with Lending Club. An external researcher might potentially obtain a large budget to deliberately fund loans with a high probability of default, in order to study their properties and to assess the model&rsquo;s true recall rate. By contrast, Lending Club itself might make data available for unfunded loans, sanitized with particular care. </p>

<p>More purely technical future research could be productive as well. For example, deep learning approaches (such as neural networks) could be investigated for their utility in extracting additional signal from the noisy LC data. As another example, additional external economic indicators could be examined, in case certain aspects of loan context would shed light on loan performance. (In particular, deriving economic predictors from the zip codes, analogous to the national economic indicators that we derived from the issue date, could be a fruitful line of inquiry.)</p>

</body>
